<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../overview.html">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">iris.heap_lang.lib.increment</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.bi.lib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="iris.bi.lib.fractional.html#"><span class="id" title="library">fractional</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.proofmode</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="iris.proofmode.tactics.html#"><span class="id" title="library">tactics</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.base_logic.lib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="iris.base_logic.lib.invariants.html#"><span class="id" title="library">invariants</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.program_logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="iris.program_logic.atomic.html#"><span class="id" title="library">atomic</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.heap_lang</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="iris.heap_lang.proofmode.html#"><span class="id" title="library">proofmode</span></a> <a class="idref" href="iris.heap_lang.notation.html#"><span class="id" title="library">notation</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#"><span class="id" title="library">atomic_heap</span></a> <a class="idref" href="iris.heap_lang.lib.par.html#"><span class="id" title="library">par</span></a>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Default</span> <span class="id" title="keyword">Proof</span> <span class="id" title="var">Using</span> "Type".<br/>

<br/>
</div>

<div class="doc">
Show that implementing fetch-and-add on top of CAS preserves logical
atomicity. 
<div class="paragraph"> </div>

 First: logically atomic increment directly on top of the physical heap. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a name="increment_physical"><span class="id" title="section">increment_physical</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{!<a class="idref" href="iris.heap_lang.lifting.html#heapG"><span class="id" title="class">heapG</span></a> <span class="id" title="var">Σ</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="incr_phy"><span class="id" title="definition">incr_phy</span></a> : <a class="idref" href="iris.heap_lang.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> "incr" "l" <a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "oldv" <a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="iris.heap_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a>"l" <a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#2a88aabfcad34bd88204e5b24bcae63c"><span class="id" title="notation">if</span></a><a class="idref" href="iris.heap_lang.notation.html#2a88aabfcad34bd88204e5b24bcae63c"><span class="id" title="notation">:</span></a> <a class="idref" href="iris.heap_lang.notation.html#CAS"><span class="id" title="abbreviation">CAS</span></a> "l" "oldv" ("oldv" <a class="idref" href="iris.heap_lang.notation.html#a4d9e3466bf1928a450a1a8426a17af3"><span class="id" title="notation">+</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#2a88aabfcad34bd88204e5b24bcae63c"><span class="id" title="notation">then</span></a> "oldv" <span class="comment">(*&nbsp;return&nbsp;old&nbsp;value&nbsp;if&nbsp;success&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#2a88aabfcad34bd88204e5b24bcae63c"><span class="id" title="notation">else</span></a> "incr" "l".<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="incr_phy_spec"><span class="id" title="lemma">incr_phy_spec</span></a> (<span class="id" title="var">l</span>: <a class="idref" href="iris.heap_lang.locations.html#loc"><span class="id" title="record">loc</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.bi.interface.html#b7d65d242d889c3e37aca6013a51bfad"><span class="id" title="notation">⊢</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&lt;&lt;&lt;</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">∀</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">(</span></a><span class="id" title="var">v</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a><a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">),</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lifting.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&gt;&gt;&gt;</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#incr_phy"><span class="id" title="definition">incr_phy</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">@</span></a> <a class="idref" href="../html-stdpp/stdpp.base.html#6c0a583aa94fbbce6fcf0f655cf1cbb7"><span class="id" title="notation">⊤</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&lt;&lt;&lt;</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lifting.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#(</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">)</span></a><a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">,</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">RET</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&gt;&gt;&gt;</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "AU". <span class="id" title="var">iLöb</span> <span class="id" title="keyword">as</span> "IH". <span class="id" title="var">wp_lam</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_bind</span> (<a class="idref" href="iris.heap_lang.notation.html#569b74bc432a2b233b93ae1b45418e26"><span class="id" title="notation">!</span></a><span class="id" title="var">_</span>)%<span class="id" title="var">E</span>. <span class="id" title="var">iMod</span> "AU" <span class="id" title="keyword">as</span> (<span class="id" title="var">v</span>) "[Hl [Hclose _]]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_load</span>. <span class="id" title="var">iMod</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a>"Hclose" <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "Hl"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> "AU". <span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_pures</span>. <span class="id" title="var">wp_bind</span> (<a class="idref" href="iris.heap_lang.lang.html#heap_lang.CmpXchg"><span class="id" title="constructor">CmpXchg</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)%<span class="id" title="var">E</span>. <span class="id" title="var">iMod</span> "AU" <span class="id" title="keyword">as</span> (<span class="id" title="var">w</span>) "[Hl Hclose]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="../html-stdpp/stdpp.base.html#decide"><span class="id" title="definition">decide</span></a> (<a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">v</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">w</span>)) <span class="id" title="keyword">as</span> [[= -&gt;]|<span class="id" title="var">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">wp_cmpxchg_suc</span>. <span class="id" title="var">iDestruct</span> "Hclose" <span class="id" title="keyword">as</span> "[_ Hclose]". <span class="id" title="var">iMod</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a>"Hclose" <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "Hl"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> "HΦ".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">wp_pures</span>. <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">wp_cmpxchg_fail</span>. <span class="id" title="var">iDestruct</span> "Hclose" <span class="id" title="keyword">as</span> "[Hclose _]". <span class="id" title="var">iMod</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a>"Hclose" <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "Hl"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> "AU".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">wp_pures</span>. <span class="id" title="var">iApply</span> "IH". <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="iris.heap_lang.lib.increment.html#increment_physical"><span class="id" title="section">increment_physical</span></a>.<br/>

<br/>
</div>

<div class="doc">
Next: logically atomic increment on top of an arbitrary logically atomic heap 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <a name="increment"><span class="id" title="section">increment</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{!<a class="idref" href="iris.heap_lang.lifting.html#heapG"><span class="id" title="class">heapG</span></a> <span class="id" title="var">Σ</span>} {<span class="id" title="var">aheap</span>: <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#atomic_heap"><span class="id" title="class">atomic_heap</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#e15c0eb40e61adefe95778c26e7840f6"><span class="id" title="variable">Σ</span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="var">atomic_heap.notation</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="incr"><span class="id" title="definition">incr</span></a> : <a class="idref" href="iris.heap_lang.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> "incr" "l" <a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "oldv" <a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#f1a50235b4a74144e06b5544f8b6bc99"><span class="id" title="notation">!</span></a>"l" <a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#2a88aabfcad34bd88204e5b24bcae63c"><span class="id" title="notation">if</span></a><a class="idref" href="iris.heap_lang.notation.html#2a88aabfcad34bd88204e5b24bcae63c"><span class="id" title="notation">:</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#notation.CAS"><span class="id" title="abbreviation">CAS</span></a> "l" "oldv" ("oldv" <a class="idref" href="iris.heap_lang.notation.html#a4d9e3466bf1928a450a1a8426a17af3"><span class="id" title="notation">+</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#2a88aabfcad34bd88204e5b24bcae63c"><span class="id" title="notation">then</span></a> "oldv" <span class="comment">(*&nbsp;return&nbsp;old&nbsp;value&nbsp;if&nbsp;success&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#2a88aabfcad34bd88204e5b24bcae63c"><span class="id" title="notation">else</span></a> "incr" "l".<br/>

<br/>
</div>

<div class="doc">
A proof of the incr specification that unfolds the definition
      of atomic accessors.  Useful for introducing them as a concept,
      but see below for a shorter proof. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="incr_spec_direct"><span class="id" title="lemma">incr_spec_direct</span></a> (<span class="id" title="var">l</span>: <a class="idref" href="iris.heap_lang.locations.html#loc"><span class="id" title="record">loc</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.bi.interface.html#b7d65d242d889c3e37aca6013a51bfad"><span class="id" title="notation">⊢</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&lt;&lt;&lt;</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">∀</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">(</span></a><span class="id" title="var">v</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a><a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">),</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#38903c5e3a2176fcf6119ef028c07d11"><span class="id" title="notation">↦</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&gt;&gt;&gt;</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">@</span></a> <a class="idref" href="../html-stdpp/stdpp.base.html#6c0a583aa94fbbce6fcf0f655cf1cbb7"><span class="id" title="notation">⊤</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&lt;&lt;&lt;</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#38903c5e3a2176fcf6119ef028c07d11"><span class="id" title="notation">↦</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#(</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">)</span></a><a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">,</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">RET</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&gt;&gt;&gt;</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "AU". <span class="id" title="var">iLöb</span> <span class="id" title="keyword">as</span> "IH". <span class="id" title="var">wp_lam</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">awp_apply</span> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#load_spec"><span class="id" title="method">load_spec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;the&nbsp;atomic&nbsp;update&nbsp;for&nbsp;load&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="iris.bi.lib.atomic.html#atomic_acc"><span class="id" title="definition">atomic_acc</span></a> /=. <span class="id" title="var">iMod</span> "AU" <span class="id" title="keyword">as</span> (<span class="id" title="var">v</span>) "[Hl [Hclose _]]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span>. <span class="id" title="var">iFrame</span> "Hl". <span class="id" title="var">iSplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;abort&nbsp;case&nbsp;*)</span> <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hl". <span class="id" title="var">iMod</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a>"Hclose" <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "Hl"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> "AU". <span class="id" title="var">iModIntro</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;go&nbsp;on&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">awp_apply</span> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#cas_spec"><span class="id" title="lemma">cas_spec</span></a>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;the&nbsp;atomic&nbsp;update&nbsp;for&nbsp;CAS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> /<a class="idref" href="iris.bi.lib.atomic.html#atomic_acc"><span class="id" title="definition">atomic_acc</span></a> /=. <span class="id" title="var">iMod</span> "AU" <span class="id" title="keyword">as</span> (<span class="id" title="var">w</span>) "[Hl Hclose]".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iModIntro</span>. <span class="id" title="var">iExists</span> <span class="id" title="var">_</span>. <span class="id" title="var">iFrame</span> "Hl". <span class="id" title="var">iSplit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;abort&nbsp;case&nbsp;*)</span> <span class="id" title="var">iDestruct</span> "Hclose" <span class="id" title="keyword">as</span> "[? _]". <span class="id" title="var">done</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hl". <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> (<a class="idref" href="../html-stdpp/stdpp.base.html#decide"><span class="id" title="definition">decide</span></a> (<a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">w</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">v</span>)) <span class="id" title="keyword">as</span> [[= -&gt;]|<span class="id" title="var">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iDestruct</span> "Hclose" <span class="id" title="keyword">as</span> "[_ Hclose]". <span class="id" title="var">iMod</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a>"Hclose" <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "Hl"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> "HΦ".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;". <span class="id" title="var">wp_if</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iDestruct</span> "Hclose" <span class="id" title="keyword">as</span> "[Hclose _]". <span class="id" title="var">iMod</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a>"Hclose" <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "Hl"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> "AU".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "!&gt;". <span class="id" title="var">wp_if</span>. <span class="id" title="var">iApply</span> "IH". <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A proof of the incr specification that uses lemmas to avoid reasining
      with the definition of atomic accessors. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="incr_spec"><span class="id" title="lemma">incr_spec</span></a> (<span class="id" title="var">l</span>: <a class="idref" href="iris.heap_lang.locations.html#loc"><span class="id" title="record">loc</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.bi.interface.html#b7d65d242d889c3e37aca6013a51bfad"><span class="id" title="notation">⊢</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&lt;&lt;&lt;</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">∀</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">(</span></a><span class="id" title="var">v</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a><a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">),</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#38903c5e3a2176fcf6119ef028c07d11"><span class="id" title="notation">↦</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&gt;&gt;&gt;</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">@</span></a> <a class="idref" href="../html-stdpp/stdpp.base.html#6c0a583aa94fbbce6fcf0f655cf1cbb7"><span class="id" title="notation">⊤</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&lt;&lt;&lt;</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#38903c5e3a2176fcf6119ef028c07d11"><span class="id" title="notation">↦</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#(</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">)</span></a><a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">,</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">RET</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&gt;&gt;&gt;</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">Φ</span>) "AU". <span class="id" title="var">iLöb</span> <span class="id" title="keyword">as</span> "IH". <span class="id" title="var">wp_lam</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">awp_apply</span> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#load_spec"><span class="id" title="method">load_spec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;the&nbsp;atomic&nbsp;update&nbsp;for&nbsp;load&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a><a class="idref" href="iris.bi.lib.atomic.html#aacc_aupd_abort"><span class="id" title="lemma">aacc_aupd_abort</span></a> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "AU"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">x</span>) "H↦". <span class="id" title="var">iAaccIntro</span> <span class="id" title="keyword">with</span> "H↦"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "$ !&gt; AU !&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;go&nbsp;on&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">awp_apply</span> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#cas_spec"><span class="id" title="lemma">cas_spec</span></a>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;the&nbsp;atomic&nbsp;update&nbsp;for&nbsp;CAS&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a><a class="idref" href="iris.bi.lib.atomic.html#aacc_aupd"><span class="id" title="lemma">aacc_aupd</span></a> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "AU"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">x'</span>) "H↦". <span class="id" title="var">iAaccIntro</span> <span class="id" title="keyword">with</span> "H↦"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">iFrame</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "H↦ !&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> (<a class="idref" href="../html-stdpp/stdpp.base.html#decide"><span class="id" title="definition">decide</span></a> (<a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">x'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">x</span>)) <span class="id" title="keyword">as</span> [[= -&gt;]|<span class="id" title="var">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iRight</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iIntros</span> "HΦ !&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_if</span>. <span class="id" title="tactic">by</span> <span class="id" title="var">iApply</span> "HΦ".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iLeft</span>. <span class="id" title="var">iFrame</span>. <span class="id" title="var">iIntros</span> "AU !&gt;".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_if</span>. <span class="id" title="var">iApply</span> "IH". <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A "weak increment": assumes that there is no race 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="weak_incr"><span class="id" title="definition">weak_incr</span></a>: <a class="idref" href="iris.heap_lang.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">rec</span></a><a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:</span></a> "weak_incr" "l" <a class="idref" href="iris.heap_lang.notation.html#3b4611ead68c65413f980c1d4a390696"><span class="id" title="notation">:=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "oldv" <a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#f1a50235b4a74144e06b5544f8b6bc99"><span class="id" title="notation">!</span></a>"l" <a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"l" <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#1e1b9f926934eee481e97c171f436dc1"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#1e1b9f926934eee481e97c171f436dc1"><span class="id" title="notation">(</span></a>"oldv" <a class="idref" href="iris.heap_lang.notation.html#a4d9e3466bf1928a450a1a8426a17af3"><span class="id" title="notation">+</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a>1<a class="idref" href="iris.heap_lang.lib.atomic_heap.html#1e1b9f926934eee481e97c171f436dc1"><span class="id" title="notation">)</span></a><a class="idref" href="iris.heap_lang.notation.html#2ec28258c896f2c046d760685d2be2ab"><span class="id" title="notation">;;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"oldv" <span class="comment">(*&nbsp;return&nbsp;old&nbsp;value&nbsp;*)</span>.<br/>

<br/>
</div>

<div class="doc">
Logically atomic spec for weak increment. Also an example for what TaDA
      calls "private precondition". 
</div>
<div class="code">
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO:&nbsp;Generalize&nbsp;to&nbsp;q&nbsp;and&nbsp;1-q,&nbsp;based&nbsp;on&nbsp;some&nbsp;theory&nbsp;for&nbsp;a&nbsp;"maybe-mapsto"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connective&nbsp;that&nbsp;works&nbsp;on&nbsp;<span class="inlinecode"><span class="id" title="var">option</span></span> <span class="inlinecode"><span class="id" title="var">Qp</span></span>&nbsp;(the&nbsp;type&nbsp;of&nbsp;1-q).&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="weak_incr_spec"><span class="id" title="lemma">weak_incr_spec</span></a> (<span class="id" title="var">l</span>: <a class="idref" href="iris.heap_lang.locations.html#loc"><span class="id" title="record">loc</span></a>) (<span class="id" title="var">v</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#c29330f110b7d515c205834f39414168"><span class="id" title="notation">↦{</span></a>1<a class="idref" href="../html-stdpp/stdpp.numbers.html#b367fe1f60d28d5f2cdbe098c5012f78"><span class="id" title="notation">/</span></a>2<a class="idref" href="iris.heap_lang.lib.atomic_heap.html#c29330f110b7d515c205834f39414168"><span class="id" title="notation">}</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="iris.bi.interface.html#0f70793a7efc24c230ef5e3a6ac95b68"><span class="id" title="notation">-∗</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&lt;&lt;&lt;</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">∀</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">(</span></a><span class="id" title="var">v'</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a><a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">),</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#c29330f110b7d515c205834f39414168"><span class="id" title="notation">↦{</span></a>1<a class="idref" href="../html-stdpp/stdpp.numbers.html#b367fe1f60d28d5f2cdbe098c5012f78"><span class="id" title="notation">/</span></a>2<a class="idref" href="iris.heap_lang.lib.atomic_heap.html#c29330f110b7d515c205834f39414168"><span class="id" title="notation">}</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v'"><span class="id" title="variable">v'</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&gt;&gt;&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.lib.increment.html#weak_incr"><span class="id" title="definition">weak_incr</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">@</span></a> <a class="idref" href="../html-stdpp/stdpp.base.html#6c0a583aa94fbbce6fcf0f655cf1cbb7"><span class="id" title="notation">⊤</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&lt;&lt;&lt;</span></a> <a class="idref" href="iris.bi.interface.html#08ba0c98aaa0db435a5f99ebae3ae8e7"><span class="id" title="notation">⌜</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#v'"><span class="id" title="variable">v'</span></a><a class="idref" href="iris.bi.interface.html#08ba0c98aaa0db435a5f99ebae3ae8e7"><span class="id" title="notation">⌝</span></a> <a class="idref" href="iris.bi.interface.html#17a7b93bfefac02a752836d54e5bc9da"><span class="id" title="notation">∗</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#l"><span class="id" title="variable">l</span></a> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#38903c5e3a2176fcf6119ef028c07d11"><span class="id" title="notation">↦</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#(</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.ZArith.BinInt.html#46584eddd5fdb16176a10a2843177d3a"><span class="id" title="notation">+</span></a> 1<a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">)</span></a><a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">,</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">RET</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="iris.program_logic.atomic.html#9d3d76104a52001d4b635576eb96f514"><span class="id" title="notation">&gt;&gt;&gt;</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hl" (<span class="id" title="var">Φ</span>) "AU". <span class="id" title="var">wp_lam</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_apply</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#e0200f70855f988886fbc8c4fdcdb53d"><span class="id" title="notation">(</span></a><a class="idref" href="iris.program_logic.atomic.html#atomic_wp_seq"><span class="id" title="lemma">atomic_wp_seq</span></a> <a class="idref" href="iris.proofmode.ltac_tactics.html#e0200f70855f988886fbc8c4fdcdb53d"><span class="id" title="notation">$!</span></a> <a class="idref" href="iris.proofmode.ltac_tactics.html#e0200f70855f988886fbc8c4fdcdb53d"><span class="id" title="notation">(</span></a><a class="idref" href="iris.heap_lang.lib.atomic_heap.html#load_spec"><span class="id" title="method">load_spec</span></a> <span class="id" title="var">_</span><a class="idref" href="iris.proofmode.ltac_tactics.html#e0200f70855f988886fbc8c4fdcdb53d"><span class="id" title="notation">)</span></a> <a class="idref" href="iris.proofmode.ltac_tactics.html#e0200f70855f988886fbc8c4fdcdb53d"><span class="id" title="notation">with</span></a> "Hl"<a class="idref" href="iris.proofmode.ltac_tactics.html#e0200f70855f988886fbc8c4fdcdb53d"><span class="id" title="notation">)</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "Hl". <span class="id" title="var">awp_apply</span> <a class="idref" href="iris.heap_lang.lib.atomic_heap.html#store_spec"><span class="id" title="method">store_spec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;the&nbsp;atomic&nbsp;update&nbsp;for&nbsp;store&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iApply</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a><a class="idref" href="iris.bi.lib.atomic.html#aacc_aupd_commit"><span class="id" title="lemma">aacc_aupd_commit</span></a> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "AU"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> (<span class="id" title="var">x</span>) "H↦".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iDestruct</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a><a class="idref" href="iris.heap_lang.lib.atomic_heap.html#mapsto_agree"><span class="id" title="method">mapsto_agree</span></a> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "Hl H↦"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> %[= &lt;-].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iCombine</span> "Hl" "H↦" <span class="id" title="keyword">as</span> "Hl". <span class="id" title="var">iAaccIntro</span> <span class="id" title="keyword">with</span> "Hl".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iIntros</span> "[$ $]"; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "$ !&gt;". <span class="id" title="var">iSplit</span>; <span class="id" title="tactic">first</span> <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "HΦ !&gt;". <span class="id" title="var">wp_seq</span>. <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="iris.heap_lang.lib.increment.html#increment"><span class="id" title="section">increment</span></a>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <a name="increment_client"><span class="id" title="section">increment_client</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{!<a class="idref" href="iris.heap_lang.lifting.html#heapG"><span class="id" title="class">heapG</span></a> <span class="id" title="var">Σ</span>, !<a class="idref" href="iris.heap_lang.lib.spawn.html#spawnG"><span class="id" title="class">spawnG</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#e15c0eb40e61adefe95778c26e7840f6"><span class="id" title="variable">Σ</span></a>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">primitive_atomic_heap</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="incr_client"><span class="id" title="definition">incr_client</span></a> : <a class="idref" href="iris.heap_lang.lang.html#heap_lang.val"><span class="id" title="inductive">val</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#704630d98f03f1fa6c74ab29b9831803"><span class="id" title="notation">λ</span></a><a class="idref" href="iris.heap_lang.notation.html#704630d98f03f1fa6c74ab29b9831803"><span class="id" title="notation">:</span></a> "x"<a class="idref" href="iris.heap_lang.notation.html#704630d98f03f1fa6c74ab29b9831803"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">let</span></a><a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:</span></a> "l" <a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">:=</span></a> <a class="idref" href="iris.heap_lang.notation.html#c11666ed6ce5aadc11a8960dae69c19a"><span class="id" title="notation">ref</span></a> "x" <a class="idref" href="iris.heap_lang.notation.html#f2a86cf1716b42d91300f888867d22e8"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.heap_lang.lib.increment.html#incr"><span class="id" title="definition">incr</span></a> "l" <a class="idref" href="iris.heap_lang.lib.par.html#bb5e4014bb8346e3083b4c2252892b17"><span class="id" title="notation">|||</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#incr"><span class="id" title="definition">incr</span></a> "l".<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="incr_client_safe"><span class="id" title="lemma">incr_client_safe</span></a> (<span class="id" title="var">x</span>: <a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a>):<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="iris.bi.interface.html#b7d65d242d889c3e37aca6013a51bfad"><span class="id" title="notation">⊢</span></a> <a class="idref" href="iris.bi.weakestpre.html#e2706ea976d881a45650125d605dd218"><span class="id" title="notation">WP</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#incr_client"><span class="id" title="definition">incr_client</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="iris.bi.weakestpre.html#e2706ea976d881a45650125d605dd218"><span class="id" title="notation">{{</span></a> <span class="id" title="var">_</span><a class="idref" href="iris.bi.weakestpre.html#e2706ea976d881a45650125d605dd218"><span class="id" title="notation">,</span></a> <a class="idref" href="iris.bi.interface.html#1fb20ec9249c1b9a628d0af33d4b6be7"><span class="id" title="notation">True</span></a> <a class="idref" href="iris.bi.weakestpre.html#e2706ea976d881a45650125d605dd218"><span class="id" title="notation">}}</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">using</span> <span class="id" title="keyword">Type</span>*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_lam</span>. <span class="id" title="var">wp_alloc</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> "Hl".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iMod</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">(</span></a><a class="idref" href="iris.base_logic.lib.invariants.html#inv_alloc"><span class="id" title="lemma">inv_alloc</span></a> <a class="idref" href="../html-stdpp/stdpp.namespaces.html#nroot"><span class="id" title="definition">nroot</span></a> <span class="id" title="var">_</span> (<a class="idref" href="iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">∃</span></a><span class="id" title="var">x'</span>:<a class="idref" href="http://coq.inria.fr/distrib/V8.11.1/stdlib//Coq.Numbers.BinNums.html#Z"><span class="id" title="inductive">Z</span></a><a class="idref" href="iris.bi.interface.html#6a949150dff4dc18cd2632b730bdfc23"><span class="id" title="notation">,</span></a> <span class="id" title="var">l</span> <a class="idref" href="iris.heap_lang.lifting.html#db9bde1508f348dd1f9d24e9d4ead804"><span class="id" title="notation">↦</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><a class="idref" href="iris.heap_lang.lib.increment.html#x'"><span class="id" title="variable">x'</span></a>)%<span class="id" title="var">I</span> <a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">with</span></a> "[Hl]"<a class="idref" href="iris.proofmode.ltac_tactics.html#c65a9d4b357f2165cc71fe44c81db669"><span class="id" title="notation">)</span></a> <span class="id" title="keyword">as</span> "#Hinv"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;I&nbsp;am&nbsp;only&nbsp;using&nbsp;persistent&nbsp;stuff,&nbsp;so&nbsp;I&nbsp;should&nbsp;be&nbsp;allowed<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;move&nbsp;this&nbsp;to&nbsp;the&nbsp;persisten&nbsp;context&nbsp;even&nbsp;without&nbsp;the&nbsp;additional&nbsp;□.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iAssert</span> (<a class="idref" href="iris.bi.derived_connectives.html#ca36a4dbd976785c580c311a32a8423e"><span class="id" title="notation">□</span></a> <a class="idref" href="iris.bi.weakestpre.html#e2706ea976d881a45650125d605dd218"><span class="id" title="notation">WP</span></a> <a class="idref" href="iris.heap_lang.lib.increment.html#incr"><span class="id" title="definition">incr</span></a> <a class="idref" href="iris.heap_lang.notation.html#66e8f9d9f9894a066beff0d1c67d3c77"><span class="id" title="notation">#</span></a><span class="id" title="var">l</span> <a class="idref" href="iris.bi.weakestpre.html#e2706ea976d881a45650125d605dd218"><span class="id" title="notation">{{</span></a> <span class="id" title="var">_</span><a class="idref" href="iris.bi.weakestpre.html#e2706ea976d881a45650125d605dd218"><span class="id" title="notation">,</span></a> <a class="idref" href="iris.bi.interface.html#1fb20ec9249c1b9a628d0af33d4b6be7"><span class="id" title="notation">True</span></a> <a class="idref" href="iris.bi.weakestpre.html#e2706ea976d881a45650125d605dd218"><span class="id" title="notation">}}</span></a>)%<span class="id" title="var">I</span> <span class="id" title="keyword">as</span> "#Aupd".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">iIntros</span> "!&gt;". <span class="id" title="var">awp_apply</span> <a class="idref" href="iris.heap_lang.lib.increment.html#incr_spec"><span class="id" title="lemma">incr_spec</span></a>. <span class="id" title="tactic">clear</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iInv</span> <a class="idref" href="../html-stdpp/stdpp.namespaces.html#nroot"><span class="id" title="definition">nroot</span></a> <span class="id" title="keyword">as</span> (<span class="id" title="var">x</span>) "&gt;H↦". <span class="id" title="var">iAaccIntro</span> <span class="id" title="keyword">with</span> "H↦"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> 10.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iIntros</span> "H↦ !&gt;". <span class="id" title="var">iSplitL</span> "H↦"; <span class="id" title="tactic">first</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span> 10.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;continuation:&nbsp;From&nbsp;after&nbsp;the&nbsp;atomic&nbsp;triple&nbsp;to&nbsp;the&nbsp;postcondition&nbsp;of&nbsp;the&nbsp;WP&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wp_apply</span> <a class="idref" href="iris.heap_lang.lib.par.html#wp_par"><span class="id" title="lemma">wp_par</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iAssumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iAssumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">iIntros</span> (??) "_ !&gt;". <span class="id" title="var">done</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="iris.heap_lang.lib.increment.html#increment_client"><span class="id" title="section">increment_client</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
